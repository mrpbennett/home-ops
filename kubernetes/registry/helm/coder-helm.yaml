apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: coder
  namespace: argocd
spec:
  project: default
  source:
    chart: coder
    repoURL: https://helm.coder.com/v2
    targetRevision: 2.13.0
    helm:
      valuesObject:
        coder:
          # coder.env -- The environment variables to set for Coder.
          env:
            - name: CODER_ACCESS_URL
              value: http://coder.pnfb.home

            - name: CODER_PG_CONNECTION_URL
              valueFrom:
                secretKeyRef:
                  name: coder-db-url
                  key: url

          # coder.volumeMounts -- A list of extra volume mounts to add to the Coder pod.
          volumeMounts:
            - name: coder-storage
              mountPath: "/mnt/storage/coder"

          # coder.ingress -- The Ingress object to expose for Coder.
          ingress:
            enabled: true
            host: coder.pnfb.home
            tls:
              enabled: false

  destination:
    server: "https://kubernetes.default.svc"
    namespace: coder
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
