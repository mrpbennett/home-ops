# ECK-OPERATOR
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: eck-operator
  namespace: argocd
spec:
  destination:
    server: "https://kubernetes.default.svc"
    namespace: elastic-system
  project: default
  source:
    chart: eck-operator
    repoURL: https://helm.elastic.co
    targetRevision: 2.14.0
    helm:
      valuesObject:
        installCRDs: true
        replicaCount: 1

        resources:
          limits:
            cpu: 1
            memory: 1Gi
          requests:
            cpu: 100m
            memory: 150Mi

        webhook:
          enabled: true
          caBundle: Cg==
          certManagerCert: null
          certsDir: "/tmp/k8s-webhook-server/serving-certs"
          failurePolicy: Ignore
          manageCerts: true
          namespaceSelector: {}
          objectSelector: {}
          port: 9443
          certsSecret: ""

  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
---
# ECK-STACK
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: eck-stack
  namespace: argocd
spec:
  destination:
    server: "https://kubernetes.default.svc"
    namespace: elastic-system
  project: default
  source:
    chart: eck-stack
    repoURL: https://helm.elastic.co
    targetRevision: 0.12.0
    helm:
      valuesObject:
        eck-elasticsearch:
          enabled: true

          http:
            service:
              spec:
                type: LoadBalancer

          ingress:
            enabled: true
            className: nginx
            hosts:
              - host: elastic.70ld.home
                path: /

        eck-kibana:
          enabled: true
          spec:
            count: 1
            elasticsearchRef:
              name: eck-elasticsearch
              namespace: elastic-system

          ingress:
            enabled: true
            className: nginx
            hosts:
              - host: kibana.70ld.home
                path: /

        eck-logstash:
          enabled: true
          count: 1

          elasticsearchRefs:
            - namespace: elastic-system
              name: eck-elasticsearch

  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
