apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: &app harbor
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "2"
spec:
  destination:
    server: "https://kubernetes.default.svc"
    namespace: *app
  project: default
  source:
    chart: *app
    repoURL: https://helm.goharbor.io
    targetRevision: 1.17.1
    helm:
      valuesObject:
        existingSecretAdminPasswordKey: HARBOR_ADMIN_PASSWORD
        harborAdminPassword: "123qwe!!"

        expose:
          type: ingress
          tls:
            enabled: true
            certSource: secret
            secret:
              secretName: root-secret
          ingress:
            hosts:
              core: harbor.home.local
            controller: default
            annotations:
              nginx.ingress.kubernetes.io/ssl-redirect: "true"
              nginx.ingress.kubernetes.io/proxy-body-size: "0"
          clusterIP:
            name: harbor
            ports:
              httpPort: 80
              httpsPort: 443

        externalURL: https://harbor.home.local

        internalTLS:
          enabled: true
          certSource: manual
          trustCa: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJlRENDQVIyZ0F3SUJBZ0lSQUlweTdRcVVHa0NIaTNST01yUUpsbWd3Q2dZSUtvWkl6ajBFQXdJd0d6RVoKTUJjR0ExVUVBeE1RYlhrdGMyVnNabk5wWjI1bFpDMWpZVEFlRncweU5UQTNNRE14TXpVeE16UmFGdzB5TlRFdwpNREV4TXpVeE16UmFNQnN4R1RBWEJnTlZCQU1URUcxNUxYTmxiR1p6YVdkdVpXUXRZMkV3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFSclRHMTZROUFIMkxBMWJFS1NkV084MjVSWm5oM0N6Nlg0UlFUbHZvNXgKOUZWeXNFZ2dVSTV5RjFVd1lTUmxCWXN2NXV1WkZuN0h6V0xEQ3lQL1FnakRvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVXdTOUI2SkVHcW1ibU8zODIvU3E1CjNFa2NNS1l3Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loQU9IZitvY1NIMi9EcjNXcExFYVFHeDNVbEtSN3REVjAKNjN4cVdCMDZsYlNOQWlFQXdpWVRtL0NrYnFjM0hobDh1Z0d6aUZsYnV5V0FLa1FOOVltSDlZWWFvNGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
          core:
            secretName: root-secret
            crt: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJlRENDQVIyZ0F3SUJBZ0lSQUlweTdRcVVHa0NIaTNST01yUUpsbWd3Q2dZSUtvWkl6ajBFQXdJd0d6RVoKTUJjR0ExVUVBeE1RYlhrdGMyVnNabk5wWjI1bFpDMWpZVEFlRncweU5UQTNNRE14TXpVeE16UmFGdzB5TlRFdwpNREV4TXpVeE16UmFNQnN4R1RBWEJnTlZCQU1URUcxNUxYTmxiR1p6YVdkdVpXUXRZMkV3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFSclRHMTZROUFIMkxBMWJFS1NkV084MjVSWm5oM0N6Nlg0UlFUbHZvNXgKOUZWeXNFZ2dVSTV5RjFVd1lTUmxCWXN2NXV1WkZuN0h6V0xEQ3lQL1FnakRvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVXdTOUI2SkVHcW1ibU8zODIvU3E1CjNFa2NNS1l3Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loQU9IZitvY1NIMi9EcjNXcExFYVFHeDNVbEtSN3REVjAKNjN4cVdCMDZsYlNOQWlFQXdpWVRtL0NrYnFjM0hobDh1Z0d6aUZsYnV5V0FLa1FOOVltSDlZWWFvNGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"
            key: "LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUxWN3RRd3I2aTdUL2lIWExzN2p4NTJZRHAxM1VnazJrZlVRV2lJTGh3bnVvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFYTB4dGVrUFFCOWl3Tld4Q2tuVmp2TnVVV1o0ZHdzK2wrRVVFNWI2T2NmUlZjckJJSUZDTwpjaGRWTUdFa1pRV0xMK2JybVJaK3g4MWl3d3NqLzBJSXd3PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo="
          jobservice:
            secretName: root-secret
            crt: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJlRENDQVIyZ0F3SUJBZ0lSQUlweTdRcVVHa0NIaTNST01yUUpsbWd3Q2dZSUtvWkl6ajBFQXdJd0d6RVoKTUJjR0ExVUVBeE1RYlhrdGMyVnNabk5wWjI1bFpDMWpZVEFlRncweU5UQTNNRE14TXpVeE16UmFGdzB5TlRFdwpNREV4TXpVeE16UmFNQnN4R1RBWEJnTlZCQU1URUcxNUxYTmxiR1p6YVdkdVpXUXRZMkV3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFSclRHMTZROUFIMkxBMWJFS1NkV084MjVSWm5oM0N6Nlg0UlFUbHZvNXgKOUZWeXNFZ2dVSTV5RjFVd1lTUmxCWXN2NXV1WkZuN0h6V0xEQ3lQL1FnakRvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVXdTOUI2SkVHcW1ibU8zODIvU3E1CjNFa2NNS1l3Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loQU9IZitvY1NIMi9EcjNXcExFYVFHeDNVbEtSN3REVjAKNjN4cVdCMDZsYlNOQWlFQXdpWVRtL0NrYnFjM0hobDh1Z0d6aUZsYnV5V0FLa1FOOVltSDlZWWFvNGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"
            key: "LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUxWN3RRd3I2aTdUL2lIWExzN2p4NTJZRHAxM1VnazJrZlVRV2lJTGh3bnVvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFYTB4dGVrUFFCOWl3Tld4Q2tuVmp2TnVVV1o0ZHdzK2wrRVVFNWI2T2NmUlZjckJJSUZDTwpjaGRWTUdFa1pRV0xMK2JybVJaK3g4MWl3d3NqLzBJSXd3PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo="
          registry:
            secretName: root-secret
            crt: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJlRENDQVIyZ0F3SUJBZ0lSQUlweTdRcVVHa0NIaTNST01yUUpsbWd3Q2dZSUtvWkl6ajBFQXdJd0d6RVoKTUJjR0ExVUVBeE1RYlhrdGMyVnNabk5wWjI1bFpDMWpZVEFlRncweU5UQTNNRE14TXpVeE16UmFGdzB5TlRFdwpNREV4TXpVeE16UmFNQnN4R1RBWEJnTlZCQU1URUcxNUxYTmxiR1p6YVdkdVpXUXRZMkV3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFSclRHMTZROUFIMkxBMWJFS1NkV084MjVSWm5oM0N6Nlg0UlFUbHZvNXgKOUZWeXNFZ2dVSTV5RjFVd1lTUmxCWXN2NXV1WkZuN0h6V0xEQ3lQL1FnakRvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVXdTOUI2SkVHcW1ibU8zODIvU3E1CjNFa2NNS1l3Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loQU9IZitvY1NIMi9EcjNXcExFYVFHeDNVbEtSN3REVjAKNjN4cVdCMDZsYlNOQWlFQXdpWVRtL0NrYnFjM0hobDh1Z0d6aUZsYnV5V0FLa1FOOVltSDlZWWFvNGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"
            key: "LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUxWN3RRd3I2aTdUL2lIWExzN2p4NTJZRHAxM1VnazJrZlVRV2lJTGh3bnVvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFYTB4dGVrUFFCOWl3Tld4Q2tuVmp2TnVVV1o0ZHdzK2wrRVVFNWI2T2NmUlZjckJJSUZDTwpjaGRWTUdFa1pRV0xMK2JybVJaK3g4MWl3d3NqLzBJSXd3PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo="
          portal:
            secretName: root-secret
            crt: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJlRENDQVIyZ0F3SUJBZ0lSQUlweTdRcVVHa0NIaTNST01yUUpsbWd3Q2dZSUtvWkl6ajBFQXdJd0d6RVoKTUJjR0ExVUVBeE1RYlhrdGMyVnNabk5wWjI1bFpDMWpZVEFlRncweU5UQTNNRE14TXpVeE16UmFGdzB5TlRFdwpNREV4TXpVeE16UmFNQnN4R1RBWEJnTlZCQU1URUcxNUxYTmxiR1p6YVdkdVpXUXRZMkV3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFSclRHMTZROUFIMkxBMWJFS1NkV084MjVSWm5oM0N6Nlg0UlFUbHZvNXgKOUZWeXNFZ2dVSTV5RjFVd1lTUmxCWXN2NXV1WkZuN0h6V0xEQ3lQL1FnakRvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVXdTOUI2SkVHcW1ibU8zODIvU3E1CjNFa2NNS1l3Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loQU9IZitvY1NIMi9EcjNXcExFYVFHeDNVbEtSN3REVjAKNjN4cVdCMDZsYlNOQWlFQXdpWVRtL0NrYnFjM0hobDh1Z0d6aUZsYnV5V0FLa1FOOVltSDlZWWFvNGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"
            key: "LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUxWN3RRd3I2aTdUL2lIWExzN2p4NTJZRHAxM1VnazJrZlVRV2lJTGh3bnVvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFYTB4dGVrUFFCOWl3Tld4Q2tuVmp2TnVVV1o0ZHdzK2wrRVVFNWI2T2NmUlZjckJJSUZDTwpjaGRWTUdFa1pRV0xMK2JybVJaK3g4MWl3d3NqLzBJSXd3PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo="
          trivy:
            secretName: root-secret
            crt: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJlRENDQVIyZ0F3SUJBZ0lSQUlweTdRcVVHa0NIaTNST01yUUpsbWd3Q2dZSUtvWkl6ajBFQXdJd0d6RVoKTUJjR0ExVUVBeE1RYlhrdGMyVnNabk5wWjI1bFpDMWpZVEFlRncweU5UQTNNRE14TXpVeE16UmFGdzB5TlRFdwpNREV4TXpVeE16UmFNQnN4R1RBWEJnTlZCQU1URUcxNUxYTmxiR1p6YVdkdVpXUXRZMkV3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFSclRHMTZROUFIMkxBMWJFS1NkV084MjVSWm5oM0N6Nlg0UlFUbHZvNXgKOUZWeXNFZ2dVSTV5RjFVd1lTUmxCWXN2NXV1WkZuN0h6V0xEQ3lQL1FnakRvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVXdTOUI2SkVHcW1ibU8zODIvU3E1CjNFa2NNS1l3Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loQU9IZitvY1NIMi9EcjNXcExFYVFHeDNVbEtSN3REVjAKNjN4cVdCMDZsYlNOQWlFQXdpWVRtL0NrYnFjM0hobDh1Z0d6aUZsYnV5V0FLa1FOOVltSDlZWWFvNGc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"
            key: "LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUxWN3RRd3I2aTdUL2lIWExzN2p4NTJZRHAxM1VnazJrZlVRV2lJTGh3bnVvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFYTB4dGVrUFFCOWl3Tld4Q2tuVmp2TnVVV1o0ZHdzK2wrRVVFNWI2T2NmUlZjckJJSUZDTwpjaGRWTUdFa1pRV0xMK2JybVJaK3g4MWl3d3NqLzBJSXd3PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo="

        persistence:
          enabled: true
          resourcePolicy: ""
          persistentVolumeClaim:
            registry:
              storageClassName: "longhorn"
              subPath: ""
              accessMode: ReadWriteOnce
              size: 50Gi
              annotations: {}

            database:
              existingClaim: ""
              storageClass: "longhorn"
              subPath: ""
              accessMode: ReadWriteOnce
              size: 1Gi
              annotations: {}

            redis:
              existingClaim: ""
              storageClass: "longhorn"
              subPath: ""
              accessMode: ReadWriteOnce
              size: 1Gi
              annotations: {}

            trivy:
              existingClaim: ""
              storageClass: "longhorn"
              subPath: ""
              accessMode: ReadWriteOnce
              size: 5Gi
              annotations: {}

          imageChartStorage:
            disableredirect: false
            type: s3
            s3:
              # Set an existing secret for S3 accesskey and secretkey
              # keys in the secret should be REGISTRY_STORAGE_S3_ACCESSKEY and REGISTRY_STORAGE_S3_SECRETKEY for registry
              #existingSecret: ""
              region: uk-south
              bucket: harbor-registry
              accesskey: ZLrMYXFvhtwaxnPVGyBp
              secretkey: cUeSYSCyoRxGs8HavS22ZCQSInv5Rc9snOdoZ8f5
              regionendpoint: https://minio.home.local
              # encrypt: false
              # keyid: mykeyid
              # secure: true
              # skipverify: false
              # v4auth: true
              # chunksize: "5242880"
              rootdirectory: /
              storageclass: STANDARD
              multipartcopychunksize: "33554432"
              multipartcopymaxconcurrency: 100
              multipartcopythresholdsize: "33554432"

        database:
          type: external
          external:
            host: "cnpg-cluster-rw.cnpg-cluster.svc.cluster.local"
            port: "5432"
            username: harbor
            password: password
            coreDatabase: harbor-registry

  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
