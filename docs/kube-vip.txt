cxx


Pick your VIP ahead of time

# FIRST SERVER
curl -sfL https://get.k3s.io | K3S_TOKEN=cxx sh -s - server \
    --cluster-init \
    --disable=traefik \
    --disable=servicelb \
    --tls-san=192.168.6.10 # Optional, needed if using a fixed registration address


## KUBE VIP

su -
apt install jq

Generating the manifest

export VIP=192.168.6.10
export INTERFACE=ens18
KVVERSION=$(curl -sL https://api.github.com/repos/kube-vip/kube-vip/releases | jq -r ".[0].name")

For containerd, run the below command:

alias kube-vip="ctr image pull ghcr.io/kube-vip/kube-vip:$KVVERSION; ctr run --rm --net-host ghcr.io/kube-vip/kube-vip:$KVVERSION vip /kube-vip"

kube-vip manifest daemonset \
    --interface $INTERFACE \
    --address $VIP \
    --inCluster \
    --taint \
    --controlplane \
    --services \
    --arp \
    --leaderElection

# On-Premises (kube-vip-cloud-controller) kube-vip On-Prem

Install the kube-vip Cloud Provider

kubectl apply -f https://raw.githubusercontent.com/kube-vip/kube-vip-cloud-provider/main/manifest/kube-vip-cloud-controller.yaml

Create a global CIDR or IP Range

kubectl create configmap -n kube-system kubevip --from-literal range-global=192.168.6.11-192.168.6.31


# ADDIONTAL SERVER
curl -sfL https://get.k3s.io | K3S_TOKEN=cxx sh -s - server \
    --server https://192.168.6.1:6443 \
    --disable=traefik \
    --disable=servicelb \
    --tls-san=192.168.6.10 # Optional, needed if using a fixed registration address


# AGENT
curl -sfL https://get.k3s.io | K3S_TOKEN=cxx sh -s - agent --server https://192.168.6.1:6443

# KUBE CONF

sudo cat /etc/rancher/k3s/k3s.yaml



